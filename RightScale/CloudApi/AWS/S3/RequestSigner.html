<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: RightScale::CloudApi::AWS::S3::RequestSigner
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../../';
  framesUrl = "../../../../frames.html#!RightScale/CloudApi/AWS/S3/RequestSigner.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../../RightScale.html" title="RightScale (module)">RightScale</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../CloudApi.html" title="RightScale::CloudApi (module)">CloudApi</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../AWS.html" title="RightScale::CloudApi::AWS (module)">AWS</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../S3.html" title="RightScale::CloudApi::AWS::S3 (module)">S3</a></span></span>
     &raquo; 
    <span class="title">RequestSigner</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: RightScale::CloudApi::AWS::S3::RequestSigner
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">CloudApi::Routine</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">CloudApi::Routine</li>
          
            <li class="next">RightScale::CloudApi::AWS::S3::RequestSigner</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/cloud/aws/s3/routines/request_signer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>S3 Request signer</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Link/RequestSigner.html" title="RightScale::CloudApi::AWS::S3::Link::RequestSigner (class)">Link::RequestSigner</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="RequestSigner/Error.html" title="RightScale::CloudApi::AWS::S3::RequestSigner::Error (class)">Error</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="SUB_RESOURCES-constant" class="">SUB_RESOURCES =
          <div class="docstring">
  <div class="discussion">
    
<p>This guys are used to sign a request</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qwords_beg'>%w{
</span><span class='tstring_content'>acl</span><span class='words_sep'>
</span><span class='tstring_content'>cors</span><span class='words_sep'>
</span><span class='tstring_content'>delete</span><span class='words_sep'>
</span><span class='tstring_content'>lifecycle</span><span class='words_sep'>
</span><span class='tstring_content'>location</span><span class='words_sep'>
</span><span class='tstring_content'>logging</span><span class='words_sep'>
</span><span class='tstring_content'>notification</span><span class='words_sep'>
</span><span class='tstring_content'>policy</span><span class='words_sep'>
</span><span class='tstring_content'>requestPayment</span><span class='words_sep'>
</span><span class='tstring_content'>tagging</span><span class='words_sep'>
</span><span class='tstring_content'>torrent</span><span class='words_sep'>
</span><span class='tstring_content'>uploads</span><span class='words_sep'>
</span><span class='tstring_content'>versionId</span><span class='words_sep'>
</span><span class='tstring_content'>versioning</span><span class='words_sep'>
</span><span class='tstring_content'>versions</span><span class='words_sep'>
</span><span class='tstring_end'>website</span></span></pre></dd>
      
        <dt id="OVERRIDE_RESPONSE_HEADERS-constant" class="">OVERRIDE_RESPONSE_HEADERS =
          <div class="docstring">
  <div class="discussion">
    
<p>Using Query String API Amazon allows to override some of response headers:</p>

<p>response-content-type response-content-language response-expires
reponse-cache-control response-content-disposition
response-content-encoding</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectGET.html?r=2145" target="_parent" title="http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectGET.html?r=2145">http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectGET.html?r=2145</a></li>
    
  </ul>

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^response-</span><span class='regexp_end'>/</span></span></pre></dd>
      
        <dt id="ONE_YEAR_OF_SECONDS-constant" class="">ONE_YEAR_OF_SECONDS =
          <div class="docstring">
  <div class="discussion">
    
<p>One year in seconds</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>365</span><span class='op'>*</span><span class='int'>60</span><span class='op'>*</span><span class='int'>60</span><span class='op'>*</span><span class='int'>24</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_body-instance_method" title="#compute_body (instance method)">- (Object) <strong>compute_body</strong>(body, content_type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns response body.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_bucket_name_and_object_path-instance_method" title="#compute_bucket_name_and_object_path (instance method)">- (Array) <strong>compute_bucket_name_and_object_path</strong>(bucket, relative_path) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extracts S3 bucket name and escapes relative path.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_headers%21-instance_method" title="#compute_headers! (instance method)">- (Hash) <strong>compute_headers!</strong>(headers, body, host) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets response headers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_host-instance_method" title="#compute_host (instance method)">- (URI) <strong>compute_host</strong>(bucket, uri) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Figure out if we need to add bucket name into the host name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_path-instance_method" title="#compute_path (instance method)">- (String) <strong>compute_path</strong>(bucket, object) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Builds request path.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_dns_bucket%3F-instance_method" title="#is_dns_bucket? (instance method)">- (Boolean) <strong>is_dns_bucket?</strong>(bucket) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns <code>true</code> if DNS compatible buckets are enabled (default)
and the given bucket is DNS compatible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#no_dns_buckets%3F-instance_method" title="#no_dns_buckets? (instance method)">- (Boolean) <strong>no_dns_buckets?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (void) <strong>process</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Authenticates an S3 request.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="compute_body-instance_method">
  
    - (<tt>Object</tt>) <strong>compute_body</strong>(body, content_type) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns response body</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>body</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>content_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 168</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_body'>compute_body</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_body'>body</span> <span class='kw'>if</span> <span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='comment'># Make sure it is a String instance
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_body'>body</span> <span class='kw'>unless</span> <span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_contentify_body'>contentify_body</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_bucket_name_and_object_path-instance_method">
  
    - (<tt>Array</tt>) <strong>compute_bucket_name_and_object_path</strong>(bucket, relative_path) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extracts S3 bucket name and escapes relative path</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_subject'>subject</span><span class='period'>.</span><span class='id identifier rubyid_compute_bucket_name_and_object_path'>compute_bucket_name_and_object_path</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my-test-bucket/foo/bar/банана.jpg</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt;
</span>  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my-test-bucket</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo%2Fbar%2F%D0%B1%D0%B0%D0%BD%D0%B0%D0%BD%D0%B0.jpg</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>relative_path</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><dl class="rdoc-list label-list"><dt>bucket, escaped_relative_path
<dd></dd></dl>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_bucket_name_and_object_path'>compute_bucket_name_and_object_path</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_relative_path'>relative_path</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_relative_path'>relative_path</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_bucket'>bucket</span>
  <span class='comment'># This is a very first attempt:
</span>  <span class='id identifier rubyid_relative_path'>relative_path</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([^\/]*)\/?(.*)$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span>
  <span class='comment'># Escape part of the path that may have UTF-8 chars (in S3 Object name for instance).
</span>  <span class='comment'># Amazon wants them to be escaped before we sign the request.
</span>  <span class='comment'># P.S. but do not escape &quot;/&quot; (signature v4 does not like this)
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_new_bucket'>new_bucket</span> <span class='op'>=</span> <span class='backref'>$1</span>
  <span class='id identifier rubyid_pre_object'>pre_object</span> <span class='op'>=</span> <span class='backref'>$2</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_object'>object</span>     <span class='op'>=</span> <span class='id identifier rubyid_pre_object'>pre_object</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='const'>Utils</span><span class='op'>::</span><span class='const'>AWS</span><span class='op'>::</span><span class='id identifier rubyid_amz_escape'>amz_escape</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'># Preserve &#39;/&#39; if it is the last symbol of the object because it is an operation on a folder
</span>  <span class='id identifier rubyid_object'>object</span>    <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_pre_object'>pre_object</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span>
  <span class='lbracket'>[</span> <span class='id identifier rubyid_new_bucket'>new_bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_headers!-instance_method">
  
    - (<tt>Hash</tt>) <strong>compute_headers!</strong>(headers, body, host) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets response headers</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>headers</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>body</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_headers!'>compute_headers!</span><span class='lparen'>(</span><span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>
  <span class='comment'># Make sure &#39;content-type&#39; is set.
</span>  <span class='comment'># P.S. Ruby 2.1+ sets &#39;content-type&#39; by default for POST and PUT requests.
</span>  <span class='comment'>#      So we need to include it into our signature to avoid the error below:
</span>  <span class='comment'>#      &#39;The request signature we calculated does not match the signature you provided.
</span>  <span class='comment'>#       Check your key and signing method.&#39;
</span>  <span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_set_if_blank'>set_if_blank</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>binary/octet-stream</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_headers'>headers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_host-instance_method">
  
    - (<tt>URI</tt>) <strong>compute_host</strong>(bucket, uri) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Figure out if we need to add bucket name into the host name</p>

<p>If there was a redirect and it had &#39;location&#39; header then there is
nothing to do with the host, otherwise we have to add the bucket to the
host.</p>

<p>P.S. When Amazon returns a redirect (usually 301) with the new host in the
message body, the new host does not have the bucket name in it. But if it
is 307 and the host is in the location header then that host name already
includes the bucket in it. The only thing we can do so far is to check if
the host name starts with the bucket and the name is at least 4th level DNS
name.</p>

<p>Examples:</p>

<pre class="code ruby"><code class="ruby">* my-bucket.s3-ap-southeast-2.amazonaws.com
* my-bucket.s3.amazonaws.com
* s3.amazonaws.com</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>uri</span>
      
      
        <span class='type'>(<tt>URI</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>URI</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_host'>compute_host</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_uri'>uri</span> <span class='kw'>unless</span> <span class='id identifier rubyid_is_dns_bucket?'>is_dns_bucket?</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_uri'>uri</span> <span class='kw'>if</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket'>bucket</span><span class='embexpr_end'>}</span><span class='tstring_content'>\..+\.[^.]+\.[^.]+$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket'>bucket</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_uri'>uri</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_path-instance_method">
  
    - (<tt>String</tt>) <strong>compute_path</strong>(bucket, object) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Builds request path</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204
205
206
207</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_path'>compute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_bucket'>bucket</span> <span class='kw'>unless</span> <span class='id identifier rubyid_is_dns_bucket?'>is_dns_bucket?</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_object'>object</span>
  <span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_join_urn'>join_urn</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_dns_bucket?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_dns_bucket?</strong>(bucket) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if DNS compatible buckets are enabled (default)
and the given bucket is DNS compatible</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 215</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_dns_bucket?'>is_dns_bucket?</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_no_dns_buckets?'>no_dns_buckets?</span>
  <span class='const'>Utils</span><span class='op'>::</span><span class='const'>AWS</span><span class='op'>::</span><span class='id identifier rubyid_is_dns_bucket?'>is_dns_bucket?</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="no_dns_buckets?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>no_dns_buckets?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_no_dns_buckets?'>no_dns_buckets?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:options</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:cloud</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:no_dns_buckets</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process-instance_method">
  
    - (<tt>void</tt>) <strong>process</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Authenticates an S3 request</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='comment'># no example</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cloud/aws/s3/routines/request_signer.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process'>process</span>
  <span class='id identifier rubyid_uri'>uri</span>            <span class='op'>=</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:connection</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:uri</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_body'>body</span>           <span class='op'>=</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:body</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_bucket'>bucket</span>         <span class='op'>=</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:bucket</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_object'>object</span>         <span class='op'>=</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:relative_path</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_compute_bucket_name_and_object_path'>compute_bucket_name_and_object_path</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_body'>body</span>           <span class='op'>=</span> <span class='id identifier rubyid_compute_body'>compute_body</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span>            <span class='op'>=</span> <span class='id identifier rubyid_compute_host'>compute_host</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_compute_headers!'>compute_headers!</span><span class='lparen'>(</span><span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>

  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:connection</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:uri</span><span class='rbracket'>]</span>        <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:bucket</span><span class='rbracket'>]</span>        <span class='op'>=</span> <span class='id identifier rubyid_bucket'>bucket</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:relative_path</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_object'>object</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:body</span><span class='rbracket'>]</span>          <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span>          <span class='op'>=</span> <span class='id identifier rubyid_compute_path'>compute_path</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>

  <span class='const'>Utils</span><span class='op'>::</span><span class='const'>AWS</span><span class='op'>::</span><span class='id identifier rubyid_sign_v4_signature'>sign_v4_signature</span><span class='lparen'>(</span>
    <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:credentials</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:aws_access_key_id</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:credentials</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:aws_secret_access_key</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:connection</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:uri</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span>
    <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Jun  1 08:34:50 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>